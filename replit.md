# 뉴스타운 자동화 대시보드

## 프로젝트 개요
네이버 뉴스를 수집하여 PostgreSQL 데이터베이스와 구글 시트에 저장하고, 뉴스타운과 골프타임즈에 자동으로 업로드하는 멀티 플랫폼 시스템입니다. Streamlit 기반 GUI 대시보드로 모든 기능을 통합 관리합니다.

## 로그인 계정
| 아이디 | 비밀번호 | 권한 |
|--------|----------|------|
| admin | test1234 | 관리자 (전체 기능) |
| ksj0070086 | ksj0070086 | 일반 사용자 (네이버 API 설정 제외) |

## 주요 기능
- **뉴스 수집**: 네이버 뉴스 API로 카테고리별 뉴스 수집 (DB + 구글시트 동시 저장)
- **키워드 검색**: 수동으로 뉴스 검색 후 선택하여 저장
- **뉴스 조회**: DB/시트 저장 뉴스와 뉴스타운 업로드 뉴스 구분 표시
- **프롬프트 관리**: AI 뉴스 가공용 프롬프트 관리
- **멀티 플랫폼 업로드**: 뉴스타운(E,F,H열)과 골프타임즈(J,K,L열) 동시 지원
- **업로드 감시**: Selenium으로 뉴스타운/골프타임즈 자동 업로드
- **완료행 삭제**: 업로드 완료된 행 자동 삭제
- **키워드 관리**: 개별 삭제 가능한 Core/General 키워드 관리

## 실행 방법
```bash
streamlit run dashboard.py
```

## 프로젝트 구조
```
├── dashboard.py              # Streamlit 대시보드 (메인 GUI)
├── naver_to_sheet.py         # 뉴스 수집 스크립트
├── 뉴스타운_자동업로드_감시.py  # 멀티 플랫폼 업로드 감시 스크립트 (Selenium)
├── 골프타임즈_자동업로드.py    # 골프타임즈 업로드 모듈 (Selenium)
├── 뉴스타운_완료행_삭제.py     # 완료행 삭제 스크립트
├── config/
│   ├── dashboard_config.json # 대시보드 설정
│   └── naver_api.json        # 네이버 API 키 (별도 보관)
├── scripts/
│   ├── run_news_collection.py
│   ├── run_upload_monitor.py
│   └── run_row_deletion.py
└── utils/
    ├── config_manager.py
    ├── process_manager.py
    └── database.py
```

## 데이터베이스 테이블
### news
- id, title, content, link
- **category**: 대분류 카테고리 (연애/경제/스포츠)
- **search_keyword**: 검색에 사용된 키워드 (예: 손흥민, 결혼, 주식)
- source, ai_title, ai_content (AI 가공 결과)
- status: pending (대기) / uploaded (뉴스타운 업로드 완료) / failed
- created_at, uploaded_at

### prompts
- id, name, category, prompt_text, is_active

### settings (신규 - 2024-12-31)
- id, key (unique), value (JSON), updated_at
- **배포 환경에서도 설정이 유지되도록 DB에 저장**
- key 목록: news_collection, category_keywords, upload_monitor, row_deletion, google_sheet, newstown, golftimes, naver_api, news_schedule, upload_platforms

## 필수 설정
- `DATABASE_URL`: PostgreSQL 연결 (자동)
- `config/naver_api.json`: 네이버 API 키
- `credentials.json`: 구글 서비스 계정 키
- 대시보드 설정 페이지에서: 구글 시트 URL, 뉴스타운 로그인 정보

## 페이지 구성
1. **대시보드**: 프로세스 제어, 키워드 설정
2. **키워드 검색**: 수동 뉴스 검색 및 저장 (최신순/인기순)
3. **뉴스 조회**: DB/시트 저장됨 | 뉴스타운 업로드됨 탭 구분
4. **프롬프트**: AI 가공용 프롬프트 관리
5. **설정**: API, 로그인, 간격 설정

## UI 특징
- 깔끔한 흑백 미니멀 디자인
- 작은 글자 크기로 정보 밀도 향상
- 표(DataFrame) 형태로 데이터 표시
- 키워드 개별 삭제 기능

## 최근 변경사항
- 2026-01-20: **멀티 플랫폼 업로드** - 뉴스타운과 골프타임즈 동시 지원, 설정 페이지에서 개별 활성화 가능
- 2026-01-20: **골프타임즈 자동업로드 모듈** - 골프타임즈_자동업로드.py 추가 (문화→핫이슈 섹션)
- 2026-01-20: **스프레드시트 열 분리** - 뉴스타운(E,F,H열), 골프타임즈(J,K,L열) 독립 관리
- 2024-12-31: **설정 DB 저장** - 키워드, 수집 간격 등 모든 설정을 PostgreSQL에 저장하여 배포 후에도 설정 유지
- 2024-12-31: **백그라운드 스케줄러 DB 기반** - 대시보드 없이도 설정된 간격으로 자동 수집
- 2024-12-31: **키워드 무작위 수집** - 매 실행 시 키워드 순서를 랜덤 셔플하여 균등 수집
- 2024-12-07: 동시 업로드 기능 추가 - 뉴스타운에 2~3개 뉴스를 동시에 업로드 가능 (설정 페이지에서 개수 조절)
- 2024-12-07: 네이버 API 사용량 표시 추가 - 설정 페이지에서 오늘 호출 수, 수집 뉴스 수, 남은 한도 확인
- 2024-12-07: 배치 내 중복 체크 추가 - 같은 수집 세션에서 유사한 기사 자동 제외
- 2024-12-07: 키워드 검색 버튼 콜백 방식 개선 - 전체 선택/해제 안정성 향상
- 2024-12-06: 뉴스 수집 자동 스케줄 기능 추가 - 설정된 간격(시간)마다 자동 수집 (대시보드 열려 있을 때 작동)
- 2024-12-06: DB↔시트 동기화 탭 추가 - 양방향 동기화 상태 확인 및 맞춤 삭제
- 2024-12-06: 뉴스 조회 표 형태 UI 개선 - dataframe으로 시각적 구분
- 2024-12-06: 뉴스 삭제 기능 추가 - DB와 시트에서 동시 삭제
- 2024-12-06: 뉴스타운 업로드 시 DB 상태 자동 업데이트 (pending → uploaded)
- 2024-12-06: 키워드 검색 저장 시 중복 체크 강화 (55% 유사도 + 70% 키워드)
- 2024-12-06: 전체 선택 버튼 개선 - 콜백 방식으로 재구성
- 2024-12-06: 뉴스타운 3차 섹션 선택 추가 (데일리핫이슈 → 연예/경제/스포츠 → 일반뉴스)
- 2024-12-06: ProcessManager 파일 기반 상태 저장 (/tmp/process_status.json)
- 2024-12-06: 카테고리 불일치 스킵 제거 (SKIP_MISMATCHED_CATEGORY=False)
- 2024-12-06: 정렬 옵션 지원 (SORT_OPTION) - 인기순(sim) / 최신순(date)
- 2024-12: 흑백 미니멀 UI 적용
- 2024-12: 네이버 API 별도 설정 파일 분리
- 2024-12: 뉴스 조회 탭 분리 (DB/시트 vs 뉴스타운)
- 2024-12: 키워드 검색 페이지 추가

## 중복 방지 로직 (강화됨 v2)
1. **링크 중복 체크**: DB와 시트의 기존 링크와 비교
2. **정규화 제목 체크**: 제목 정규화 후 완전 일치 비교
3. **유사도 40% 체크**: 제목 유사도 0.40 이상이면 중복 처리 (더 엄격)
4. **키워드 중복 50%**: 핵심 키워드/구절 50% 이상 겹치면 중복 처리
5. **고유명사 비교**: 인물명, 프로그램명 등 고유명사 일치시 중복 처리
6. **본문 유사도 50%**: 본문 앞 500자 비교하여 50% 이상이면 중복 처리

## 카테고리 키워드 구조
```json
{
  "연애": {
    "core": ["연애", "열애", "결혼", ...],  // 검색에 사용
    "general": ["신랑", "신부", ...]        // 분류에 사용
  },
  "경제": {...},
  "스포츠": {...}
}
```

## 기술 스택
- Python 3.11
- Streamlit (대시보드)
- PostgreSQL (psycopg2-binary)
- Selenium (웹 자동화)
- gspread (구글 시트 연동)
- pandas (데이터 표시)
